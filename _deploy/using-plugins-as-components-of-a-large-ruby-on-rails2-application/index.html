<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Using plugins as components of a large Ruby on Rails 2 application</title>
  <meta name="description" content="I craft maintainable software that delivers business value. Born and educated in Italy, became Australian now working in New York City.
" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="canonical" href="http://teotti.com//using-plugins-as-components-of-a-large-ruby-on-rails2-application/">

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
<!--  <link rel="stylesheet" href=""> -->
  <link rel="stylesheet" href="http://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-57294014-1', 'auto');
    ga('send', 'pageview');

  </script>
</head>

  <meta property="og:title" content="Using plugins as components of a large Ruby on Rails 2 application" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="This is a short story about the creation and maintenance of a large Ruby on Rails application, and how after initially sticking to the Rails conventions I questioned them and used Rails plugins to structure the code of new components. Thanks to Ben and Red Ant to let me use..." />
  <script data-cfasync="false" type="text/javascript" src="//filamentapp.s3.amazonaws.com/d44553ac52ef97f2dbdb691fbfa3383d.js" async="async"></script>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-54d976e32f0ec904" async="async"></script>

    <!-- header start -->

<a href="http://teotti.com/" class="logo-readium"><span class="logo" style="background-image: url(/assets/images/beach.jpg)"></span></a>

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Using plugins as components of a large Ruby on Rails 2 application</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person"></h4>
              on
              <time datetime="2013-07-16T00:00:00-04:00">16 Jul 2013</time>
              <!-- , tagged on <span class="post-tag-">, <a href="/tag/"></a></span> -->
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>This is a short story about the creation and maintenance of a large Ruby on Rails
application, and how after initially sticking to the Rails conventions I
questioned them and used Rails plugins to structure the code of new components.</p>

<p>Thanks to Ben and Red Ant to let me use the project as a use case.</p>

<h2 id="the-story">The story</h2>
<p>Sometime we work on a small size project.</p>

<p>Without much upfront design we deliver the product following the Ruby on Rails conventions,
maybe using scaffold generators, maybe dropping in a few gems.</p>

<p>It’s critical to acknowledge those scenarios, a good part of Rails’s popularity is due to those kind of projects.</p>

<p>But I believe Ruby on Rails can handle large projects too and this story is about those times.</p>

<p>I worked on this new green field project containing many concepts at the
foundation of the system, and we simply couldn’t go live without all of them.</p>

<p>This first part goes through how I realized I had to step away from some of
Ruby on Rails’s conventions in order to introduce a little bit of structure in
the large application we where working on.</p>

<p>The year was 2008 and the app was running on Rails 2.</p>

<p>Six years later I believe large Ruby on Rails apps are facing the same pitfalls. I will
discuss a more updated technical solution in a follow up article.</p>

<h2 id="the-project-huggiescomau">The project (Huggies.com.au)</h2>
<p>This was a rebuild of a big multinational brand, the legacy site was mostly presenting
content to the users, now we had to create a social experience around that content.</p>

<p>For example the name finder component in the legacy site was just browsing a list of names.
In the new build it would allow users to vote names, an improved search, creating
shortlists to share with family (which would then be allowed to vote), popularity graphs.</p>

<p>The project rebuild was ongoing for about 10 months.</p>

<p>The team was composed of two backend developers, two frontend plus designers and PMs.</p>

<p>We knew we had to implement what existed in the legacy site and deliver new/improved components:
* name finder
* promotions
* kids activities
* user registration process
* CMS
* forum</p>

<p>We decided to serve the forum from another app outside the Rails stack.
And we decided to handle the CMS as a Radiant app (a separate rails app).
Nginx would sit in front and route the URLs to the appropriate backend.</p>

<p>But the rest of the components where part of a single Ruby on Rails application.
* name finder
* promotions
* kids activities</p>

<p>And we knew that after (big bang) release the stakeholder was going to ask for
more of those vertical components.</p>

<p>Me and the other developer agreed that having all the
models inside the /app/models wasn’t going to be a sane way to work.</p>

<p>We created model subfolders and required that inside environment.rb</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">RAILS_ROOT</span><span class="si">}</span><span class="s2">/app/models/*[^.rb]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">{</span><span class="o">|</span><span class="n">dir</span><span class="o">|</span> <span class="n">config</span><span class="o">.</span><span class="n">load_paths</span> <span class="o">&lt;&lt;</span> <span class="n">dir</span> <span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ls -l app/models
ask_an_expert_models            contact_us                      loyalty_models                  recipe_finder_models            utils
babynames_models                kids_activities_models          membership_models               sharing
babynames_utils                 landing_page_header             promos_and_samples_models       story_models</code></pre></div>

<p>Inside the controllers we also had subfolders, roughly mapping the ones defined under models:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ls -l app/controllers
admin                           ask_an_expert                   contact_us_controller.rb        membership                      promos_and_samples
admin_controller.rb             babynames                       kids_activities                 my_huggies                      recipe_finder
application_controller.rb       contact_us                      loyalty                         my_huggies_controller.rb        stories</code></pre></div>

<p>Advantages of this approach:</p>

<ul>
  <li>easier to identify a knowledge ‘silo’ then having all the files in a single controller or model folder</li>
</ul>

<p>We successfully went live and kept developing new features, but after a few months the shortcomings started to surface:</p>

<ul>
  <li>sometimes it was hard to define the boundaries of the knowledge ‘silo’</li>
  <li>the migrations folder didn’t have boundaries, hence difficult to tell to which silo they belonged</li>
  <li>similarly the routes file didn’t have boundaries, we used comments blocks to highlight ‘silo’ blocks but maintaining it was a painful process</li>
  <li>we did not use namespaces which caused some helper methods to be overwritten. I think this was due to my ignorance at the time not to a Rails flaw.</li>
</ul>

<h2 id="plugins-to-the-help">Plugins to the help</h2>
<p>After reading a book about Rails that talked about plugins I
started looking in to using them to enforce structure in our application code
instead of the usual drop in functionality.</p>

<p>A plugin (in Rails 3 and above called engines) is an extension to the
main rails application, the plugin folder follows Rails’s usual directories and
make its models, controllers, views, helpers available to the main application.</p>

<p>That’s how the vendor plugin are working, but instead of creating a reusable
plugin I created a very specific one!
So it was not designed to provide a generic functionality that we would use again
in other projects but instead it was holding concepts related to a specific strand
of work (feature) of this particular project.</p>

<p>Advantages of this approach:
* most of the code related to the ‘component’ would belong inside its plugin directory
* only minor changes would happen in the app god models (usually using decoration)
* you could now isolate the routes of the new component in the plugin’s config/routes.rb which would be picked up by the main application.
* we had unit tests inside the plugin.</p>

<p>Shortcomings of the approach:</p>

<ul>
  <li>since we had plenty of vendor plugins in order to make the internal ones stand out we had to set a convention of appending the project name in front of plugin name ie.</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ls -l vendor/plugins/ <span class="p">|</span> grep hug
drwxr-xr-x   <span class="m">7</span> agenteo  <span class="m">84396665</span>  <span class="m">238</span> <span class="m">14</span> Nov 19:55 huggies_api
drwxr-xr-x   <span class="m">7</span> agenteo  <span class="m">84396665</span>  <span class="m">238</span> <span class="m">14</span> Nov 20:06 huggies_baby_room_gallery
drwxr-xr-x   <span class="m">9</span> agenteo  <span class="m">84396665</span>  <span class="m">306</span> <span class="m">14</span> Nov 20:08 huggies_blog
drwxr-xr-x  <span class="m">14</span> agenteo  <span class="m">84396665</span>  <span class="m">476</span> <span class="m">14</span> Nov 20:08 huggies_mums_tips
drwxr-xr-x   <span class="m">6</span> agenteo  <span class="m">84396665</span>  <span class="m">204</span> <span class="m">14</span> Nov 20:11 huggies_voting_tool</code></pre></div>

<p>That convention (one more thing to do for the developer) didn’t really work well,
people sometime forgot the prefix making hard to detect non vendor plugins.
* the migrations had still to be placed in the main app migration folder, so that folder kept
growing.
* we had plugins relying on the main application code, so a change to a
  plugin would require to change main application code. A better approach would
  have been to move the code in the main app in plugins. I’ll describe that
  approach in a followup article.</p>

<h2 id="conclusion">Conclusion</h2>
<p>Three new components were created as plugins before I left the company.
I felt we were on the right track to keep the app under control.</p>

<p>Moving the initial components from the main app to their own plugin would have
helped to improve consistency.</p>

<p>Even considering the shortcomings I believe this way of structuring this large
project helped us.</p>

<p>It was certainly better then having everything in /models and /controllers keeping
using subfolders or introducing SOA merely for organizational reasons.</p>

<p>I encountered a bit of skepticism on this approach from other developers.
I’ve found many Rails developers are fossilized on the conventions Rails gives
and never look at a Rails app from a different angle.
In cases of large apps some of those conventions will simply play against you
and I think we should look in to alternative paths to follow.</p>

<p>Did you find yourself working on a large Ruby on Rails application? Did you
structure the code in any particular way?</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=Using+plugins+as+components+of+a+large+Ruby+on+Rails+2+application&amp;url=http://teotti.com//using-plugins-as-components-of-a-large-ruby-on-rails2-application"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4>Enrico Teotti</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2013-07-16 00:00">16 Jul 2013</time></p>
              <p><a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> subscribe to the feed</span></a></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Related posts</span></h5>
<footer class="site-footer">
  <ul>
    
    <li><a href="/create-maintainable-mongodb-queries-in-ruby-with-query-object-and-mongoid-criterias/">Create maintainable mongodb queries in Ruby with query object and mongoid criterias</a></li>
    
    <li><a href="/reduce-memory-footprint-requiring-portions-of-your-component-based-rails-applications/">Reduce memory footprint requiring portions of your component based Rails application with Bundler</a></li>
    
    <li><a href="/one-url-segment-serving-different-resources-with-ruby-on-rails-route-constraints/">One URL segment serving different resources with Ruby on Rails route constraints</a></li>
    
    <li><a href="/ignore-query-strings-in-ruby-on-rails-caching-with-rack-cache/">Ignore query strings in Ruby on Rails caching with rack-cache</a></li>
    
    <li><a href="/building-intention-revealing-ruby-on-rails-helpers/">Building intention revealing Ruby on Rails helpers</a></li>
    
  </ul>
  <div class="inner">
    <section class="copyright">All content copyright <a href="/">Enrico Teotti</a> &copy; 2014<br>All rights reserved.</section>
  </div>
</footer>

          </div>
        </div>
        
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'enricoteotti'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/background_image.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">今日は, I am Enrico</h1>
        <h2 class="blog-description">I craft maintainable software that delivers business value. Born and educated in Italy, became Australian now working in New York City.
</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>


  </body>
</html>
